!function(){"use strict";frappe.provide("frappe.datetime"),frappe.defaultDateFormat="YYYY-MM-DD",frappe.defaultTimeFormat="HH:mm:ss",frappe.defaultDatetimeFormat=frappe.defaultDateFormat+" "+frappe.defaultTimeFormat,moment.defaultFormat=frappe.defaultDateFormat,frappe.provide("frappe.datetime"),$.extend(frappe.datetime,{convert_to_user_tz:function(e,t){if(frappe.sys_defaults.time_zone)var n=moment.tz(e,frappe.sys_defaults.time_zone).local();else n=moment(e);return!1===t?n:n.format(frappe.defaultDatetimeFormat)},convert_to_system_tz:function(e,t){if(frappe.sys_defaults.time_zone)var n=moment(e).tz(frappe.sys_defaults.time_zone);else n=moment(e);return!1===t?n:n.format(frappe.defaultDatetimeFormat)},is_timezone_same:function(){return!frappe.sys_defaults.time_zone||moment().tz(frappe.sys_defaults.time_zone).utcOffset()===moment().utcOffset()},str_to_obj:function(e){return moment(e,frappe.defaultDatetimeFormat)._d},obj_to_str:function(e){return moment(e).locale("en").format()},obj_to_user:function(e){return moment(e).format(frappe.datetime.get_user_date_fmt().toUpperCase())},get_diff:function(e,t){return moment(e).diff(t,"days")},get_hour_diff:function(e,t){return moment(e).diff(t,"hours")},get_day_diff:function(e,t){return moment(e).diff(t,"days")},add_days:function(e,t){return moment(e).add(t,"days").format()},add_months:function(e,t){return moment(e).add(t,"months").format()},week_start:function(){return moment().startOf("week").format()},week_end:function(){return moment().endOf("week").format()},month_start:function(){return moment().startOf("month").format()},month_end:function(){return moment().endOf("month").format()},quarter_start:function(){return moment().startOf("quarter").format()},quarter_end:function(){return moment().endOf("quarter").format()},year_start:function(){return moment().startOf("year").format()},year_end:function(){return moment().endOf("year").format()},get_user_time_fmt:function(){return frappe.sys_defaults&&frappe.sys_defaults.time_format||"HH:mm:ss"},get_user_date_fmt:function(){return frappe.sys_defaults&&frappe.sys_defaults.date_format||"yyyy-mm-dd"},get_user_fmt:function(){return frappe.sys_defaults&&frappe.sys_defaults.date_format||"yyyy-mm-dd"},str_to_user:function(e,t){if(void 0===t&&(t=!1),!e)return"";var n=frappe.datetime.get_user_time_fmt();if(t)return moment(e,frappe.defaultTimeFormat).format(n);var r=frappe.datetime.get_user_date_fmt().toUpperCase();return"string"!=typeof e||-1===e.indexOf(" ")?moment(e).format(r):moment(e,"YYYY-MM-DD HH:mm:ss").format(r+" "+n)},get_datetime_as_string:function(e){return moment(e).format("YYYY-MM-DD HH:mm:ss")},user_to_str:function(e,t){void 0===t&&(t=!1);var n=frappe.datetime.get_user_time_fmt();if(t)return moment(e,n).format(frappe.defaultTimeFormat);var r=frappe.datetime.get_user_date_fmt().toUpperCase(),i="YYYY-MM-DD";return-1!==e.indexOf(" ")&&(r+=" "+n,i+=" HH:mm:ss"),moment(e,[r.replace("YYYY","YY"),r]).locale("en").format(i)},user_to_obj:function(e){return frappe.datetime.str_to_obj(frappe.datetime.user_to_str(e))},global_date_format:function(e){var t=moment(e);return t._f&&-1!==t._f.indexOf("HH")?t.format("Do MMMM YYYY, h:mma"):t.format("Do MMMM YYYY")},now_date:function(e){return void 0===e&&(e=!1),frappe.datetime._date(frappe.defaultDateFormat,e)},now_time:function(e){return void 0===e&&(e=!1),frappe.datetime._date(frappe.defaultTimeFormat,e)},now_datetime:function(e){return void 0===e&&(e=!1),frappe.datetime._date(frappe.defaultDatetimeFormat,e)},_date:function(e,t){void 0===t&&(t=!1);var n,r=frappe.sys_defaults&&frappe.sys_defaults.time_zone;return n=r?moment.tz(r):moment(),t?frappe.datetime.moment_to_date_obj(n):n.format(e)},moment_to_date_obj:function(e){var t=new Date,n=e.toArray();return t.setFullYear(n[0]),t.setMonth(n[1]),t.setDate(n[2]),t.setHours(n[3]),t.setMinutes(n[4]),t.setSeconds(n[5]),t.setMilliseconds(n[6]),t},nowdate:function(){return frappe.datetime.now_date()},get_today:function(){return frappe.datetime.now_date()},get_time:function(e){return moment(e).format("hh:mm A")},validate:function(e){return moment(e,[frappe.defaultDateFormat,frappe.defaultDatetimeFormat,frappe.defaultTimeFormat],!0).isValid()},get_first_day_of_the_week_index:function(){var e=frappe.sys_defaults.first_day_of_the_week||"Sunday";return moment.weekdays().indexOf(e)}}),Object.defineProperties(window,{dateutil:{get:function(){return console.warn("Please use `frappe.datetime` instead of `dateutil`. It will be deprecated soon."),frappe.datetime},configurable:!0},date:{get:function(){return console.warn("Please use `frappe.datetime` instead of `date`. It will be deprecated soon."),frappe.datetime},configurable:!0},get_today:{get:function(){return console.warn("Please use `frappe.datetime.get_today` instead of `get_today`. It will be deprecated soon."),frappe.datetime.get_today},configurable:!0}}),frappe.provide("frappe.ui"),frappe.provide("frappe.views"),frappe.provide("frappe.web_form_list");class e{constructor(e){Object.assign(this,e),frappe.web_form_list=this,this.wrapper=document.getElementById("datatable"),this.make_actions(),this.make_filters(),$(".link-btn").remove()}refresh(){var e=this;this.table&&(Array.from(this.table.tBodies).forEach(function(e){return e.remove()}),document.getElementById("select-all").checked=!1);this.rows=[],this.page_length=20,this.web_list_start=0,frappe.run_serially([function(){return e.get_list_view_fields()},function(){return e.get_data()},function(){return e.make_table()},function(){return e.create_more()}])}make_filters(){var e=this;this.filters={},this.filter_input=[];var t=document.getElementById("list-filters");frappe.call("frappe.website.doctype.web_form.web_form.get_web_form_filters",{web_form_name:this.web_form_name}).then(function(n){n.message.forEach(function(n){var r=document.createElement("div.col-sm-4");r.classList.add("col","col-sm-3"),t.appendChild(r),n.default&&e.add_filter(n.fieldname,n.default,n.fieldtype);var i=frappe.ui.form.make_control({df:{fieldtype:n.fieldtype,fieldname:n.fieldname,options:n.options,only_select:!0,label:__(n.label),onchange:function(t){$("#more").remove(),e.add_filter(n.fieldname,i.value,n.fieldtype),e.refresh()}},parent:r,value:n.default,render_input:1});e.filter_input.push(i)}),e.refresh()})}add_filter(e,t,n){t?("Data"===n&&(t=["like",t+"%"]),Object.assign(this.filters,Object.fromEntries([[e,t]]))):delete this.filters[e]}get_list_view_fields(){var e=this;return frappe.call({method:"frappe.website.doctype.web_form.web_form.get_in_list_view_fields",args:{doctype:this.doctype}}).then(function(t){return e.fields_list=t.message})}fetch_data(){return frappe.call({method:"frappe.www.list.get_list_data",args:Object.assign({},{doctype:this.doctype,fields:this.fields_list.map(function(e){return e.fieldname}),limit_start:this.web_list_start,web_form_name:this.web_form_name},this.filters)})}async get_data(){var e=await this.fetch_data();this.data=await e.message}more(){var e=this;this.web_list_start+=this.page_length,this.fetch_data().then(function(t){0===t.message.length&&frappe.msgprint(__("No more items to display")),e.append_rows(t.message)})}make_table(){this.columns=this.fields_list.map(function(e){return{label:e.label,fieldname:e.fieldname,fieldtype:e.fieldtype}}),this.table||(this.table=document.createElement("table"),this.table.classList.add("table"),this.make_table_head()),this.append_rows(this.data),this.wrapper.appendChild(this.table)}make_table_head(){var e=this,t=this.table.createTHead();t.style.backgroundColor="#f7fafc",t.style.color="#8d99a6";var n=t.insertRow(),r=document.createElement("th"),i=document.createElement("input");function a(e,t){var n=document.createElement("th");n.innerText=t,e.appendChild(n)}i.type="checkbox",i.id="select-all",i.onclick=function(t){return e.toggle_select_all(t.target.checked)},r.appendChild(i),n.appendChild(r),a(n,__("Sr")),this.columns.forEach(function(e){a(n,__(e.label))})}append_rows(e){var t=this,n=this.table.childNodes[1]||this.table.createTBody();e.forEach(function(e){var r=n.insertRow();r.setAttribute("id",e.name);var i=new frappe.ui.WebFormListRow({row:r,doc:e,columns:t.columns,serial_number:t.rows.length+1,events:{onEdit:function(){return t.open_form(e.name)},onSelect:function(){return t.toggle_delete()}}});t.rows.push(i)})}make_actions(){var e=this,t=document.querySelector(".list-view-actions");frappe.has_permission(this.doctype,"","delete",function(){e.addButton(t,"delete-rows","danger",!0,"Delete",function(){return e.delete_rows()})}),this.addButton(t,"new","primary",!1,"New",function(){return window.location.href=window.location.pathname+"?new=1"})}addButton(e,t,n,r,i,a){if(!document.getElementById(t)){var o=document.createElement("button");"secondary"==n?o.classList.add("btn","btn-secondary","btn-sm","ml-2","text-white"):"danger"==n?o.classList.add("btn","btn-danger","button-delete","btn-sm","ml-2"):o.classList.add("btn","btn-primary","btn-sm","ml-2"),o.id=t,o.innerText=i,o.hidden=r,o.onclick=a,e.appendChild(o)}}create_more(){var e=this;if(this.rows.length>=this.page_length){var t=document.querySelector(".list-view-footer");this.addButton(t,"more","secondary",!1,"More",function(){return e.more()})}}toggle_select_all(e){this.rows.forEach(function(t){return t.toggle_select(e)})}open_form(e){window.location.href=window.location.pathname+"?name="+e}get_selected(){return this.rows.filter(function(e){return e.is_selected()})}toggle_delete(){this.settings.allow_delete&&(document.getElementById("delete-rows").hidden=!this.get_selected().length)}delete_rows(){var e=this;this.settings.allow_delete&&frappe.call({type:"POST",method:"frappe.website.doctype.web_form.web_form.delete_multiple",args:{web_form_name:this.web_form_name,docnames:this.get_selected().map(function(e){return e.doc.name})}}).then(function(){e.refresh(),e.toggle_delete()})}}frappe.ui.WebFormListRow=class{constructor(e){var t=e.row,n=e.doc,r=e.columns,i=e.serial_number,a=e.events;e.options;Object.assign(this,{row:t,doc:n,columns:r,serial_number:i,events:a}),this.make_row()}make_row(){var e=this,t=this.row.insertCell();this.checkbox=document.createElement("input"),this.checkbox.type="checkbox",this.checkbox.onclick=function(t){e.toggle_select(t.target.checked),t.stopImmediatePropagation()},t.appendChild(this.checkbox),this.row.insertCell().innerText=this.serial_number,this.columns.forEach(function(t){var n=e.row.insertCell(),r=frappe.form.get_formatter(t.fieldtype);n.innerHTML=e.doc[t.fieldname]&&__(r(e.doc[t.fieldname],t,{only_value:1},e.doc))||""}),this.row.onclick=function(){return e.events.onEdit()},this.row.style.cursor="pointer"}toggle_select(e){this.checkbox.checked=e,this.events.onSelect(e)}is_selected(){return this.checkbox.checked}},frappe.provide("frappe.utils");var t={init:function(){this.jq=jQuery({})},trigger:function(e,t){!this.jq&&this.init(),this.jq.trigger(e,t)},once:function(e,t){!this.jq&&this.init(),this.jq.one(e,function(e,n){return t(n)})},on:function(e,t){!this.jq&&this.init(),this.jq.bind(e,function(e,n){return t(n)})},off:function(e,t){!this.jq&&this.init(),this.jq.unbind(e,function(e,n){return t(n)})}};frappe.utils.make_event_emitter=function(e){return Object.assign(e,t),e},frappe.provide("frappe.ui"),frappe.provide("frappe.web_form");class n extends frappe.ui.FieldGroup{constructor(e){super(),Object.assign(this,e),frappe.web_form=this,frappe.web_form.events={},Object.assign(frappe.web_form.events,t),this.current_section=0}prepare(e,t){Object.assign(this,e),this.fields=e.web_form_fields,this.doc=t}make(){super.make(),this.set_sections(),this.set_field_values(),this.setup_listeners(),this.introduction_text&&this.set_form_description(this.introduction_text),this.allow_print&&!this.is_new&&this.setup_print_button(),this.allow_delete&&!this.is_new&&this.setup_delete_button(),this.is_new&&this.setup_cancel_button(),this.setup_primary_action(),this.setup_previous_next_button(),this.toggle_section(),$(".link-btn").remove(),frappe.init_client_script&&frappe.init_client_script(),frappe.web_form.events.trigger("after_load"),this.after_load&&this.after_load()}on(e,t){var n=this.fields_dict[e];n.df.change=function(){t(n,n.value)}}setup_listeners(){var e=this;if(e.is_multi_step_form)for(var t=0,n=$(".input-with-feedback");t<n.length;t+=1){var r=n[t];$(r).change(function(t){setTimeout(function(){t.stopPropagation(),e.toggle_buttons()},200)})}}set_sections(){this.sections.length||(this.sections=$(".form-section"))}setup_previous_next_button(){var e=this;e.is_multi_step_form&&($(".web-form-footer").after('\n\t\t\t<div id="form-step-footer" class="pull-right">\n\t\t\t\t<button class="btn btn-primary btn-previous btn-sm ml-2">'+__("Previous")+'</button>\n\t\t\t\t<button class="btn btn-primary btn-next btn-sm ml-2">'+__("Next")+"</button>\n\t\t\t</div>\n\t\t"),$(".btn-previous").on("click",function(){if(e.validate_section()){for(var t=e.current_section;t<e.sections.length;t--){var n=e.is_previous_section_empty(t);if(e.current_section=e.current_section>0?e.current_section-1:e.current_section,!n)break}e.toggle_section()}}),$(".btn-next").on("click",function(){if(e.validate_section()){for(var t=e.current_section;t<e.sections.length;t++){var n=e.is_next_section_empty(t);if(e.current_section=e.current_section<e.sections.length?e.current_section+1:e.current_section,!n)break}e.toggle_section()}}))}set_field_values(){this.doc.name&&this.set_values(this.doc)}set_default_values(){var e=frappe.utils.get_query_params();delete e.new,this.set_values(e)}set_form_description(e){document.getElementById("introduction").innerHTML=e}add_button(e,t,n,r){void 0===r&&(r=".web-form-actions");var i=document.createElement("button");i.classList.add("btn","btn-"+t,"btn-sm","ml-2"),i.innerHTML=e,i.onclick=n,document.querySelector(r).appendChild(i)}add_button_to_footer(e,t,n){this.add_button(e,t,n,".web-form-footer")}add_button_to_header(e,t,n){this.add_button(e,t,n,".web-form-actions")}setup_primary_action(){var e=this;this.add_button_to_header(this.button_label||__("Save",null,"Button in web form"),"primary",function(){return e.save()}),this.add_button_to_footer(this.button_label||__("Save",null,"Button in web form"),"primary",function(){return e.save()})}setup_cancel_button(){var e=this;this.add_button_to_header(__("Cancel",null,"Button in web form"),"light",function(){return e.cancel()})}setup_delete_button(){var e=this;frappe.has_permission(this.doc_type,"","delete",function(){e.add_button_to_header(frappe.utils.icon("delete"),"danger",function(){return e.delete()})})}setup_print_button(){var e=this;this.add_button_to_header(frappe.utils.icon("print"),"light",function(){return e.print()})}validate_section(){if(this.allow_incomplete)return!0;for(var e=[],t=[],n=0,r=$(".form-section:eq("+this.current_section+") .form-control");n<r.length;n+=1){var i=r[n],a=$(i).attr("data-fieldname");if(a&&(i=this.fields_dict[a]).get_value){var o=i.get_value();i.df.reqd&&is_null("string"==typeof o?strip_html(o):o)&&e.push(__(i.df.label)),i.df.reqd&&"Text Editor"===i.df.fieldtype&&is_null(strip_html(cstr(o)))&&e.push(__(i.df.label)),i.df.invalid&&t.push(__(i.df.label))}}var s="";return t.length&&(s+=__("Invalid values for fields:")+"<br><br><ul><li>"+t.join("<li>")+"</ul>"),e.length&&(s+=__("Mandatory fields required:")+"<br><br><ul><li>"+e.join("<li>")+"</ul>"),(t.length||e.length)&&frappe.msgprint({title:__("Error"),message:s,indicator:"orange"}),!(e.length||t.length)}toggle_section(){this.is_multi_step_form&&(this.toggle_previous_button(),this.hide_sections(),this.show_section(),this.toggle_buttons())}toggle_buttons(){for(var e=this.current_section;e<this.sections.length;e++){if(!this.is_next_section_empty(e)){this.show_next_and_hide_save_button();break}this.show_save_and_hide_next_button()}}is_next_section_empty(e){return e+1>this.sections.length||!$(".form-section:eq("+(e+1)+")").find(".frappe-control:not(.hide-control)").length}is_previous_section_empty(e){return e-1>this.sections.length||!$(".form-section:eq("+(e-1)+")").find(".frappe-control:not(.hide-control)").length}show_save_and_hide_next_button(){$(".btn-next").hide(),$(".web-form-footer").show()}show_next_and_hide_save_button(){$(".btn-next").show(),$(".web-form-footer").hide()}toggle_previous_button(){0==this.current_section?$(".btn-previous").hide():$(".btn-previous").show()}show_section(){$(".form-section:eq("+this.current_section+")").show()}hide_sections(){for(var e=0;e<this.sections.length;e++)e!==this.current_section&&$(".form-section:eq("+e+")").hide()}save(){var e=this,t=this.is_new;this.validate&&!this.validate()&&frappe.throw(__("Couldn't save, please check the data you have entered"),__("Validation Error"));var n=super.get_values(this.allow_incomplete);if(n&&!window.saving){var r=Boolean(this.accept_payment&&!this.doc.paid);return Object.assign(this.doc,n),this.doc.doctype=this.doc_type,this.doc.web_form_name=this.name,window.saving=!0,frappe.form_dirty=!1,frappe.call({type:"POST",method:"frappe.website.doctype.web_form.web_form.accept",args:{data:this.doc,web_form:this.name,docname:this.doc.name,for_payment:r},callback:function(n){n.exc||(e.handle_success(n.message),frappe.web_form.events.trigger("after_save"),e.after_save&&e.after_save(),t&&(n.message.attachment||n.message.file)&&frappe.call({type:"POST",method:"frappe.handler.upload_file",args:{file_url:n.message.attachment||n.message.file,doctype:n.message.doctype,docname:n.message.name}}))},always:function(){window.saving=!1}}),!0}}delete(){frappe.call({type:"POST",method:"frappe.website.doctype.web_form.web_form.delete",args:{web_form_name:this.name,docname:this.doc.name}})}print(){window.open("/printview?\n\t\t\tdoctype="+this.doc_type+"\n\t\t\t&name="+this.doc.name+"\n\t\t\t&format="+(this.print_format||"Standard"),"_blank")}cancel(){window.location.href=window.location.pathname}handle_success(e){var t=this;this.accept_payment&&!this.doc.paid&&(window.location.href=e);var n=new frappe.ui.Dialog({title:__("Saved Successfully"),secondary_action:function(){t.success_url?window.location.href=t.success_url:t.login_required&&(window.location.href=window.location.pathname+"?name="+e.name)}});n.show();var r=this.success_message||__("Your information has been submitted");n.set_message(r)}}frappe.ready(function(){var t=frappe.utils.get_query_params(),r=$(".web-form-wrapper"),i=parseInt(r.data("is-list"))||t.is_list,a=r.data("web-form-doctype"),o=r.data("web-form"),s=parseInt(r.data("login-required")),f=parseInt(r.data("allow-delete")),d=t.name||"",l=t.new;s?function(){var e=new frappe.ui.Dialog({title:__("Not Permitted"),primary_action_label:__("Login"),primary_action:function(){window.location.replace("/login?redirect-to="+window.location.pathname)}});e.set_message(__("You are not permitted to access this page.")),e.show()}():i?new e({parent:r,doctype:a,web_form_name:o,settings:{allow_delete:f}}):function(){var e=new n({parent:r,is_new:l,web_form_name:o});frappe.call({method:"frappe.website.doctype.web_form.web_form.get_form_data",args:{doctype:a,docname:d,web_form_name:o},freeze:!0}).then(function(t){var n,r=((n=t.message).web_form.web_form_fields.map(function(e){if(e.is_web_form=!0,"Table"===e.fieldtype)return e.get_data=function(){var t=[];return n.doc&&(t=n.doc[e.fieldname]),t},e.fields=n[e.fieldname],$.each(e.fields||[],function(e,t){"Link"===t.fieldtype&&(t.only_select=!0),t.is_web_form=!0}),"Attach"===e.fieldtype&&(e.is_private=!0),delete e.parent,delete e.parentfield,delete e.parenttype,delete e.doctype,e;"Link"===e.fieldtype&&(e.only_select=!0),["Attach","Attach Image"].includes(e.fieldtype)&&("object"!=typeof e.options&&(e.options={}),e.options.disable_file_browser=!0)}),n),i=r.web_form;i.name&&0===i.allow_edit&&(window.location.href.includes("?new=1")||window.location.replace(window.location.pathname+"?new=1"));t.message.doc||function(e){var t={};e.web_form.web_form_fields.forEach(function(e){if(e.default)return t[e.fieldname]=e.default})}(t.message);e.prepare(i,t.message.doc&&1===i.allow_edit?t.message.doc:{}),e.make(),e.set_default_values()})}(),document.querySelector("body").style.display="block"})}();
//# sourceMappingURL=web_form.min.js.map
